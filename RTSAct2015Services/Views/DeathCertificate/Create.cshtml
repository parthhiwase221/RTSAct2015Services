@{
    ViewData["Title"] = "मृत्यू प्रमाणपत्र - Death Certificate";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow">
                <div class="card-header bg-secondary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-file-medical me-2"></i>मृत्यू प्रमाणपत्राकरिता अर्ज
                        <small class="d-block">Death Certificate Application Form</small>
                    </h4>
                </div>
                <div class="card-body">
                    <form id="deathcertificate_form" enctype="multipart/form-data" method="post">
                        @Html.AntiForgeryToken()

                        <!-- Deceased Person Details -->
                        <h5 class="mb-3 text-secondary">
                            <i class="fas fa-user-times me-2"></i>मृत व्यक्तीचे तपशील (Dead Person Details)
                        </h5>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Full Name</span>
                                    <span class="marathi">(मृत व्यक्तीचे संपूर्ण नाव)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="DeceasedFullName" class="form-control" required maxlength="100">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">
                                    <span class="english">Date of Death</span>
                                    <span class="marathi">(मृत्यूची तारीख)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="date" name="DateOfDeath" class="form-control" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">
                                    <span class="english">Time of Death</span>
                                    <span class="marathi">(मृत्यूची वेळ)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="time" name="TimeOfDeath" class="form-control" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label class="form-label">
                                    <span class="english">Gender</span>
                                    <span class="marathi">(लिंग)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <select name="Gender" class="form-select" required>
                                    <option value="">-Select-</option>
                                    <option value="Male">Male (पुरुष)</option>
                                    <option value="Female">Female (स्त्री)</option>
                                    <option value="Other">Other (इतर)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">
                                    <span class="english">Age at Death</span>
                                    <span class="marathi">(मृत्यूच्या वेळचे वय)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="number" name="AgeAtDeath" class="form-control" required min="0" max="150">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Place of Death</span>
                                    <span class="marathi">(मृत्यूचे स्थान)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="PlaceOfDeath" class="form-control" required maxlength="100">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Cause of Death</span>
                                    <span class="marathi">(मृत्यूचे कारण)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <select name="CauseOfDeath" class="form-select" required>
                                    <option value="">-Select-</option>
                                    <option value="Natural">Natural Death (नैसर्गिक मृत्यू)</option>
                                    <option value="Accident">Accident (अपघात)</option>
                                    <option value="Disease">Disease (आजार)</option>
                                    <option value="Other">Other (इतर)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Hospital/Institution Name</span>
                                    <span class="marathi">(रुग्णालय/संस्थेचे नाव)</span>
                                </label>
                                <input type="text" name="HospitalName" class="form-control" maxlength="100">
                            </div>
                        </div>

                        <!-- Applicant Details -->
                        <h5 class="mb-3 text-secondary">
                            <i class="fas fa-user me-2"></i>अर्जदाराचे तपशील (Applicant Details)
                        </h5>
                        <div class="row mb-3">
                            <div class="col-md-2">
                                <label class="form-label">
                                    <span class="english">Title</span>
                                    <span class="marathi">(सौजन्य)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <select name="ApplicantTitle" class="form-select" required>
                                    <option value="">-Select-</option>
                                    <option value="श्री.">श्री.</option>
                                    <option value="श्रीमती.">श्रीमती.</option>
                                    <option value="कुमारी.">कुमारी.</option>
                                    <option value="डॉ.">डॉ.</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">
                                    <span class="english">First Name</span>
                                    <span class="marathi">(पहिले नाव)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="ApplicantFirstName" class="form-control" required maxlength="40">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">
                                    <span class="english">Middle Name</span>
                                    <span class="marathi">(मधले नाव)</span>
                                </label>
                                <input type="text" name="ApplicantMiddleName" class="form-control" maxlength="40">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">
                                    <span class="english">Last Name</span>
                                    <span class="marathi">(आडनाव)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="ApplicantLastName" class="form-control" required maxlength="40">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-5">
                                <label class="form-label">
                                    <span class="english">Relationship with Dead Person</span>
                                    <span class="marathi">(मृत व्यक्तीशी नाते)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <select name="RelationshipWithDeceased" class="form-select" required>
                                    <option value="">-Select-</option>
                                    <option value="Son">Son (पुत्र)</option>
                                    <option value="Daughter">Daughter (कन्या)</option>
                                    <option value="Husband">Husband (पती)</option>
                                    <option value="Wife">Wife (पत्नी)</option>
                                    <option value="Father">Father (वडील)</option>
                                    <option value="Mother">Mother (आई)</option>
                                    <option value="Brother">Brother (भाऊ)</option>
                                    <option value="Sister">Sister (बहीण)</option>
                                    <option value="Relative">Relative (नातेवाईक)</option>
                                    <option value="Other">Other (इतर)</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">
                                    <span class="english">Mobile No.</span>
                                    <span class="marathi">(मोबाईल क्र.)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="tel" name="Mobile" class="form-control" required maxlength="10" pattern="[6-9][0-9]{9}">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">
                                    <span class="english">Pin Code</span>
                                    <span class="marathi">(पिन कोड)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="PinCode" class="form-control" required maxlength="6" pattern="[1-9][0-9]{5}">
                            </div>
                        </div>

                        <!-- Address Details -->
                        <h5 class="mb-3 text-secondary">
                            <i class="fas fa-map-marker-alt me-2"></i>पत्ता तपशील (Address Details)
                        </h5>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Street/House No.</span>
                                    <span class="marathi">(रस्ता/घर क्र.)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="Street" class="form-control" required maxlength="60">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Area/Locality</span>
                                    <span class="marathi">(भाग/परिसर)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="Area" class="form-control" required maxlength="60">
                            </div>
                        </div>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">City</span>
                                    <span class="marathi">(शहर)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="City" class="form-control" required maxlength="40" placeholder="Enter City Name">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">District</span>
                                    <span class="marathi">(जिल्हा)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" name="District" class="form-control" required maxlength="40" placeholder="Enter District Name">
                            </div>
                        </div>

                        <!-- Certificate Requirements -->
                        <h5 class="mb-3 text-secondary">
                            <i class="fas fa-certificate me-2"></i>प्रमाणपत्र आवश्यकता (Certificate Requirements)
                        </h5>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Number of Copies Required</span>
                                    <span class="marathi">(आवश्यक प्रती संख्या)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <select name="NumberOfCopies" class="form-select" required>
                                    <option value="">-Select-</option>
                                    <option value="1">1 Copy</option>
                                    <option value="2">2 Copies</option>
                                    <option value="3">3 Copies</option>
                                    <option value="4">4 Copies</option>
                                    <option value="5">5 Copies</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Purpose of Certificate</span>
                                    <span class="marathi">(प्रमाणपत्राचा हेतू)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <select name="Purpose" class="form-select" required>
                                    <option value="">-Select-</option>
                                    <option value="Insurance Claim">Insurance Claim (विमा दावा)</option>
                                    <option value="Legal Purpose">Legal Purpose (कायदेशीर हेतू)</option>
                                    <option value="Pension">Pension (निवृत्तीवेतन)</option>
                                    <option value="Property Transfer">Property Transfer (मालमत्ता हस्तांतरण)</option>
                                    <option value="Other">Other (इतर)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Important Notice -->
                        <div class="alert alert-warning">
                            <h6 class="alert-heading">
                                <i class="fas fa-exclamation-triangle me-2"></i>महत्वाची सूचना (Important Notice)
                            </h6>
                            <p class="mb-1">
                                <small>जर तुम्ही व्यक्तीच्या मृत्यूच्या एक वर्षानंतर अर्ज करत असाल, तर कृपया प्रथम म.न.पा. आरोग्य विभागाशी संपर्क साधा आणि त्यांच्याकडून ना हरकत प्रमाणपत्र घ्या.</small>
                            </p>
                            <p class="mb-0">
                                <small>If you are applying after one year of the person's death, please contact the Municipal Corporation Health department first and get a no objection certificate from the department.</small>
                            </p>
                        </div>

                        <!-- Document Upload -->
                        <h5 class="mb-3 text-secondary">
                            <i class="fas fa-cloud-upload-alt me-2"></i>कागदपत्रे अपलोड (Document Upload)
                        </h5>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Medical Certificate/Death Report</span>
                                    <span class="marathi">(वैद्यकीय प्रमाणपत्र/मृत्यू अहवाल)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="file" name="MedicalCertificate" class="form-control" accept=".pdf,.jpg,.jpeg,.png" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Applicant's ID Proof</span>
                                    <span class="marathi">(अर्जदाराचा ओळखपत्र)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="file" name="IdProofDocument" class="form-control" accept=".pdf,.jpg,.jpeg,.png" required>
                            </div>
                        </div>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Address Proof</span>
                                    <span class="marathi">(पत्त्याचा पुरावा)</span>
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="file" name="AddressProofDocument" class="form-control" accept=".pdf,.jpg,.jpeg,.png" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <span class="english">Additional Documents</span>
                                    <span class="marathi">(अतिरिक्त कागदपत्रे)</span>
                                </label>
                                <input type="file" name="AdditionalDocument" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                                <small class="form-text text-muted">
                                    (NOC from Health Dept if applying after 1 year / 1 वर्षानंतर अर्ज केल्यास आरोग्य विभागाचे NOC)
                                </small>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid">
                            <button type="submit" class="btn btn-secondary btn-lg">
                                <i class="fas fa-paper-plane me-2"></i>
                                अर्ज सबमिट करा (Submit Application)
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            console.log("Death Certificate Form loaded");

            // Form submission handler
            $('#deathcertificate_form').on('submit', function(e) {
                e.preventDefault();

                const form = this;
                const submitBtn = $(form).find('button[type="submit"]');
                const originalText = submitBtn.html();

                // Show loading state
                submitBtn.html('<i class="fas fa-spinner fa-spin me-2"></i>Submitting...').prop('disabled', true);

                // Create FormData object
                const formData = new FormData(form);

                // AJAX call to submit form
                $.ajax({
                    url: '@Url.Action("Create", "DeathCertificate")',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        if (response.success) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Application Submitted Successfully!',
                                html: `
                                    <div class="text-center">
                                        <h5 class="text-success">${response.message}</h5>
                                        <hr>
                                        <p><strong>Application ID:</strong> <span class="text-primary">${response.data.applicationId}</span></p>
                                        <small class="text-muted">कृपया भविष्यातील संदर्भासाठी हा ID जतन करा</small>
                                    </div>
                                `,
                                confirmButtonText: 'Continue',
                                allowOutsideClick: false
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    window.location.href = '@Url.Action("Index", "Home")';
                                }
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Validation Error',
                                text: response.message || 'कृपया आपला इनपुट तपासा आणि पुन्हा प्रयत्न करा.',
                                confirmButtonText: 'OK'
                            });
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('AJAX Error:', xhr.responseText);
                        Swal.fire({
                            icon: 'error',
                            title: 'Server Error',
                            text: 'अर्ज सबमिट करताना त्रुटी झाली. कृपया नंतर पुन्हा प्रयत्न करा.',
                            confirmButtonText: 'OK'
                        });
                    },
                    complete: function() {
                        // Reset button state
                        submitBtn.html(originalText).prop('disabled', false);
                    }
                });
            });

            // Input validation for pattern attributes
            $('input[pattern]').on('blur', function() {
                const pattern = new RegExp($(this).attr('pattern'));
                const value = $(this).val();
                if (value && !pattern.test(value)) {
                    $(this).addClass('is-invalid');
                    $(this).next('.invalid-feedback').remove();
                    $(this).after('<div class="invalid-feedback">Please enter a valid format</div>');
                } else {
                    $(this).removeClass('is-invalid');
                    $(this).next('.invalid-feedback').remove();
                }
            });

            // File size validation
            $('input[type="file"]').on('change', function() {
                const maxSize = 10 * 1024 * 1024; // 10MB
                const file = this.files[0];

                if (file && file.size > maxSize) {
                    $(this).val('');
                    Swal.fire({
                        icon: 'error',
                        title: 'File Too Large',
                        text: 'File size should not exceed 10MB',
                        confirmButtonText: 'OK'
                    });
                }
            });
        });
    </script>
}
